<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>对外汉语教学平台</title>
<style>
:root{--bg:#f3f9ff;--card:#fff;--accent:#3b82f6;--muted:#374151;--danger:#ef4444}
body{font-family:"Microsoft YaHei",Arial,sans-serif;background:var(--bg);margin:0;padding:20px;color:#111}
.wrap{max-width:1100px;margin:0 auto}
.card{background:var(--card);border-radius:12px;padding:18px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
h1,h2{margin:0 0 10px}
.muted{color:var(--muted);font-size:13px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.hidden{display:none}
.options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
.opt{padding:12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;color:#000;cursor:pointer;text-align:center}
.opt.correct{background:#d1fae5;border-color:#10b981}
.opt.wrong{background:#fee2e2;border-color:#ef4444}
.word-big{font-size:36px;margin:10px 0;text-align:center}
input,select,button{font-size:14px;padding:8px;border-radius:8px;border:1px solid #d1d5db;color:#000}
button{cursor:pointer;background:var(--accent);color:#fff;border:none}
.btn-danger{background:var(--danger)}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{padding:8px;border:1px solid #d1d5db;text-align:left}
.level-badge{display:inline-block;padding:4px 8px;background:#eef2ff;border-radius:6px;margin-right:6px}
.flex{display:flex;gap:12px;align-items:center}
.search{margin-bottom:8px}
.small{font-size:13px;color:var(--muted)}
.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.selected{border:2px solid #3b82f6}
</style>
</head>
<body>
<div class="wrap">
  <!-- 登录卡 -->
  <div class="card" id="loginCard">
    <h1>对外汉语教学平台</h1>
    <div class="row">
      <div style="flex:1">
        <label>姓名 / 学号</label><br>
        <input id="studentName" placeholder="例如：Kota / S12345">
      </div>
      <div style="width:180px">
        <label>角色</label><br>
        <select id="roleSelect">
          <option value="student">学生</option>
          <option value="teacher">教师</option>
        </select>
      </div>
      <div style="width:160px;margin-top:18px">
        <button id="loginBtn">登入</button>
      </div>
    </div>
    <div id="teacherPasswordDiv" class="hidden" style="margin-top:10px">
      <label>教师密码：</label>
      <input id="teacherPassword" type="password" placeholder="请输入教师密码">
    </div>
    <p class="small" style="margin-top:8px">提示：教师点「教师模式」可查看学生成绩后台（两页面模式）。</p>
  </div>

  <!-- 主界面卡 -->
  <div class="card hidden" id="mainCard">
    <div class="row" style="justify-content:space-between">
      <div>
        <strong id="welcome"></strong> (<span id="roleTag"></span>)
      </div>
      <div class="toolbar">
        <button id="logoutBtn" class="btn-danger">登出</button>
        <button id="teacherModeBtn" class="hidden" style="background:#fbbf24;color:#000">教师模式</button>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <label>题型：</label>
      <select id="gameType">
        <option value="mc">看词选义</option>
        <option value="typing">拼写/输入</option>
        <option value="listen">听写</option>
        <option value="match">配对</option>
        <option value="pair">连连看</option>
      </select>
      <label>关卡：</label>
      <select id="levelSelect"></select>
      <button id="startGameBtn">开始闯关</button>
    </div>

    <div id="gameArea" style="margin-top:12px"></div>

    <div id="resultArea" class="hidden">
      <h3>本次得分：<span id="sessionScore"></span></h3>
      <div class="row">
        <button id="retryBtn">重玩本关</button>
      </div>
    </div>
  </div>

  <!-- 教师后台 -->
  <div class="card hidden" id="teacherCard">
    <div id="teacherOverview">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>教师后台 — 学生总览</h2>
        <div class="flex">
          <input id="searchStudent" class="search" placeholder="搜索学生姓名">
          <button id="exportAllCsvBtn">导出全班 CSV</button>
          <button id="clearScoresBtn" class="btn-danger">清空所有成绩</button>
        </div>
      </div>
      <div id="studentsListArea" style="margin-top:12px"></div>
    </div>

    <div id="teacherStudentDetail" class="hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <button id="backToOverview" style="background:#94a3b8">← 返回总览</button>
          <strong id="detailStudentName" style="margin-left:12px"></strong>
          <div id="studentProgressSummary" class="small" style="margin-top:6px"></div>
        </div>
        <div class="flex">
          <button id="exportOneCsvBtn">导出该学生 CSV</button>
          <button id="deleteStudentScoresBtn" class="btn-danger">删除该学生成绩</button>
        </div>
      </div>

      <div id="studentScoresTable" style="margin-top:12px"></div>
    </div>
  </div>
</div>

<script>
const EXERCISE_NAME = location.pathname.split('/').pop().replace('.html','') || 'L1Text1';
const TEACHER_PASSWORD = 'NK0811';
const correctSound = new Audio('correct.mp3');
const wrongSound = new Audio('wrong.mp3');

const LEVELS = [
  { name: 'Year9-Unit1', words:[
    {ch:'爸爸',pin:'bàba',en:'father'},
    {ch:'妈妈',pin:'māma',en:'mother'},
    {ch:'哥哥',pin:'gēge',en:'older brother'},
    {ch:'姐姐',pin:'jiějie',en:'older sister'},
    {ch:'弟弟',pin:'dìdi',en:'younger brother'},
    {ch:'妹妹',pin:'mèimei',en:'younger sister'}
  ]},
  { name: 'Year9-Unit2', words:[
    {ch:'爷爷',pin:'yéye',en:'grandfather'},
    {ch:'奶奶',pin:'nǎinai',en:'grandmother'},
    {ch:'叔叔',pin:'shūshu',en:'uncle'},
    {ch:'姑姑',pin:'gūgu',en:'aunt'}
  ]}
];

let scores = JSON.parse(localStorage.getItem(EXERCISE_NAME+'_scores') || '[]');
let progress = JSON.parse(localStorage.getItem(EXERCISE_NAME+'_progress') || '{}');
let currentUser = null;
let currentSession = null;

const loginCard = document.getElementById('loginCard');
const mainCard = document.getElementById('mainCard');
const teacherCard = document.getElementById('teacherCard');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const studentNameEl = document.getElementById('studentName');
const roleSelect = document.getElementById('roleSelect');
const welcomeEl = document.getElementById('welcome');
const roleTag = document.getElementById('roleTag');
const teacherModeBtn = document.getElementById('teacherModeBtn');
const gameTypeEl = document.getElementById('gameType');
const levelSelectEl = document.getElementById('levelSelect');
const startGameBtn = document.getElementById('startGameBtn');
const gameArea = document.getElementById('gameArea');
const resultArea = document.getElementById('resultArea');
const sessionScoreEl = document.getElementById('sessionScore');
const retryBtn = document.getElementById('retryBtn');
const teacherPasswordDiv = document.getElementById('teacherPasswordDiv');
const teacherPasswordInput = document.getElementById('teacherPassword');

const teacherOverview = document.getElementById('teacherOverview');
const studentsListArea = document.getElementById('studentsListArea');
const searchStudent = document.getElementById('searchStudent');
const exportAllCsvBtn = document.getElementById('exportAllCsvBtn');
const clearScoresBtn = document.getElementById('clearScoresBtn');

const teacherStudentDetail = document.getElementById('teacherStudentDetail');
const backToOverview = document.getElementById('backToOverview');
const detailStudentName = document.getElementById('detailStudentName');
const studentProgressSummary = document.getElementById('studentProgressSummary');
const studentScoresTable = document.getElementById('studentScoresTable');
const exportOneCsvBtn = document.getElementById('exportOneCsvBtn');
const deleteStudentScoresBtn = document.getElementById('deleteStudentScoresBtn');

/* 初始化关卡下拉 */
function initLevels(){ levelSelectEl.innerHTML=''; LEVELS.forEach((l,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=l.name; levelSelectEl.appendChild(opt); }); }
initLevels();

/* 登录逻辑 */
roleSelect.onchange = ()=> teacherPasswordDiv.classList.toggle('hidden', roleSelect.value !== 'teacher');
loginBtn.onclick = ()=>{
  const name = studentNameEl.value.trim(); const role=roleSelect.value;
  if(!name){ alert('请输入姓名 / 学号'); return; }
  if(role==='teacher'){ const pwd=teacherPasswordInput.value.trim(); if(!pwd){ alert('请输入教师密码'); return; } if(pwd!==TEACHER_PASSWORD){ alert('教师密码错误'); return; } }
  currentUser={name,role}; loginCard.classList.add('hidden'); mainCard.classList.remove('hidden'); welcomeEl.textContent=name; roleTag.textContent=role;
  if(role==='teacher') teacherModeBtn.classList.remove('hidden');
  if(role==='student' && progress[name]){ const p=progress[name]; alert(`检测到未完成的关卡：${p.levelName}，题型：${p.gameType}，建议继续。`); levelSelectEl.value=p.levelIndex; gameTypeEl.value=p.gameType; }
};
logoutBtn.onclick=()=>location.reload();
teacherModeBtn.onclick=()=>{ teacherCard.classList.toggle('hidden'); if(!teacherCard.classList.contains('hidden')) showTeacherOverview(); };
backToOverview.onclick=()=>showTeacherOverview();

/* 工具函数 */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function saveProgress(){ if(currentUser.role==='student'){ progress[currentUser.name]={ levelIndex:currentSession.levelIndex, levelName:currentSession.levelName, gameType:currentSession.gameType }; localStorage.setItem(EXERCISE_NAME+'_progress',JSON.stringify(progress)); } }
function saveScore(){ if(currentUser.role==='student'){ const now=new Date().toLocaleString(); scores.push({ exercise:EXERCISE_NAME, student:currentUser.name, role:currentUser.role, level:currentSession.levelName, type:currentSession.gameType, score:currentSession.score, total:currentSession.total, time:now }); localStorage.setItem(EXERCISE_NAME+'_scores',JSON.stringify(scores)); } }

/* 游戏函数完整实现 */
function renderMC(words){
  const w=shuffle([...words])[0]; const options=shuffle([w,...words.filter(x=>x!==w)].slice(0,4));
  let html=`<div class="word-big">${w.ch}</div><div class="options">`; options.forEach(o=>html+=`<div class="opt">${o.en}</div>`); html+='</div>'; gameArea.innerHTML=html;
  Array.from(document.getElementsByClassName('opt')).forEach(o=>{ o.onclick=()=>{ const isCorrect=o.textContent===w.en; o.classList.add(isCorrect?'correct':'wrong'); if(isCorrect) currentSession.score++,correctSound.play(); else wrongSound.play(); saveProgress(); setTimeout(showSessionResult,800); }});
}
function renderTyping(words){
  const w=shuffle([...words])[0]; gameArea.innerHTML=`<div class="word-big">${w.ch}</div><input id="typingInput" placeholder="输入拼音或英文"><button id="submitTyping">提交</button>`;
  document.getElementById('submitTyping').onclick=()=>{ const val=document.getElementById('typingInput').value.trim().toLowerCase(); const isCorrect=val===w.pin.toLowerCase()||val===w.en.toLowerCase(); if(isCorrect) currentSession.score++,correctSound.play(); else wrongSound.play(); saveProgress(); showSessionResult(); }
}
function renderListen(words){
  const w=shuffle([...words])[0]; gameArea.innerHTML=`<button id="playWord">播放字</button><input id="listenInput" placeholder="听写汉字"><button id="submitListen">提交</button>`;
  document.getElementById('playWord').onclick=()=>{ const utter=new SpeechSynthesisUtterance(w.ch); speechSynthesis.speak(utter); };
  document.getElementById('submitListen').onclick=()=>{ const val=document.getElementById('listenInput').value.trim(); const isCorrect=val===w.ch; if(isCorrect) currentSession.score++,correctSound.play(); else wrongSound.play(); saveProgress(); showSessionResult(); };
}
function renderMatch(words){
  const left=shuffle([...words]); const right=shuffle([...words]); let html=`<div class="row"><div style="flex:1">`; left.forEach((w)=> html+=`<div class="opt" data-ch="${w.ch}" data-en="${w.en}">${w.ch}</div>`); html+=`</div><div style="flex:1">`; right.forEach((w)=> html+=`<div class="opt" data-ch="${w.ch}" data-en="${w.en}">${w.en}</div>`); html+='</div></div>'; gameArea.innerHTML=html;
  let first=null; Array.from(document.getElementsByClassName('opt')).forEach(o=>{ o.onclick=()=>{ o.classList.add('selected'); if(!first){ first=o; return; } const isCorrect=first.dataset.ch===o.dataset.ch; if(isCorrect){currentSession.score++; correctSound.play(); first.classList.add('correct'); o.classList.add('correct'); } else wrongSound.play(); first.classList.remove('selected'); first=null; saveProgress(); setTimeout(showSessionResult,800); }});}
function renderPair(words){
  const pairs=shuffle([...words]); let html='<div class="row">'; pairs.forEach(p=>html+=`<div class="opt" data-val="${p.ch}">${p.ch}</div>`); html+='</div><div class="row">'; pairs.forEach(p=>html+=`<div class="opt" data-val="${p.ch}">${p.en}</div>`); html+='</div>'; gameArea.innerHTML=html;
  let first=null; Array.from(document.getElementsByClassName('opt')).forEach(o=>{ o.onclick=()=>{ o.classList.add('selected'); if(!first){ first=o; return; } const isCorrect=first.dataset.val===o.dataset.val; if(isCorrect){ currentSession.score++; correctSound.play(); first.classList.add('correct'); o.classList.add('correct'); } else wrongSound.play(); first.classList.remove('selected'); first=null; saveProgress(); setTimeout(showSessionResult,800); }});}
function showSessionResult(){ gameArea.innerHTML=''; resultArea.classList.remove('hidden'); sessionScoreEl.textContent=`${currentSession.score}/${currentSession.total}`; saveScore(); delete progress[currentUser.name]; localStorage.setItem(EXERCISE_NAME+'_progress',JSON.stringify(progress)); }

startGameBtn.onclick=()=>{ startGame(parseInt(levelSelectEl.value), gameTypeEl.value); };
function startGame(level,gameType){ currentSession={levelIndex:level,levelName:LEVELS[level].name,gameType,score:0,total:LEVELS[level].words.length}; gameArea.innerHTML=''; resultArea.classList.add('hidden'); const words=LEVELS[level].words; if(gameType==='mc') renderMC(words); else if(gameType==='typing') renderTyping(words); else if(gameType==='listen') renderListen(words); else if(gameType==='match') renderMatch(words); else if(gameType==='pair') renderPair(words); }
retryBtn.onclick=()=>startGameBtn.click();
</script>
</body>
</html>


    
   




  


  

 




 
 
